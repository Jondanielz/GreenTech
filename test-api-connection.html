<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test - Conexi√≥n API</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
      }
      .status {
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }
      .success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }
      .loading {
        background: #d1ecf1;
        border: 1px solid #bee5eb;
        color: #0c5460;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }
      button:hover {
        background: #0056b3;
      }
      pre {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
      }
      .info {
        background: #e7f3ff;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <h1>üîç Test de Conexi√≥n a la API</h1>

    <div class="info">
      <h3>Instrucciones:</h3>
      <ol>
        <li>
          Aseg√∫rate de que <strong>Apache</strong> est√° corriendo en XAMPP
        </li>
        <li>Aseg√∫rate de que <strong>MySQL</strong> est√° corriendo en XAMPP</li>
        <li>Haz click en el bot√≥n "Probar Conexi√≥n"</li>
      </ol>
    </div>

    <button onclick="testConnection()">üîÑ Probar Conexi√≥n a la API</button>

    <div id="result"></div>

    <script>
      async function testConnection() {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML =
          '<div class="status loading">‚è≥ Probando conexi√≥n...</div>';

        try {
          // Test 1: Probar endpoint ra√≠z
          console.log(
            "üì° Intentando conectar a: http://localhost/eco-app/greentech/api"
          );

          const response = await fetch(
            "http://localhost/eco-app/greentech/api",
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
                Accept: "application/json",
              },
            }
          );

          console.log("‚úÖ Respuesta recibida:", response.status);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();
          console.log("üì¶ Datos recibidos:", data);

          // Mostrar resultado exitoso
          resultDiv.innerHTML = `
                    <div class="status success">
                        <h3>‚úÖ Conexi√≥n Exitosa</h3>
                        <p><strong>Estado HTTP:</strong> ${response.status}</p>
                        <p><strong>API:</strong> ${data.message || "OK"}</p>
                        <p><strong>Versi√≥n:</strong> ${
                          data.version || "N/A"
                        }</p>
                        <h4>Datos Completos:</h4>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
        } catch (error) {
          console.error("‚ùå Error:", error);

          // Determinar el tipo de error
          let errorMessage = "";
          let suggestion = "";

          if (
            error.message === "Failed to fetch" ||
            error.name === "TypeError"
          ) {
            errorMessage = "No se puede conectar con el servidor";
            suggestion = `
                        <h4>Soluciones:</h4>
                        <ol>
                            <li><strong>Inicia Apache en XAMPP</strong>
                                <ul>
                                    <li>Abre el Panel de Control de XAMPP</li>
                                    <li>Click en "Start" junto a Apache</li>
                                    <li>Espera a que el bot√≥n cambie a "Stop" (con fondo verde)</li>
                                </ul>
                            </li>
                            <li><strong>Inicia MySQL en XAMPP</strong>
                                <ul>
                                    <li>Click en "Start" junto a MySQL</li>
                                </ul>
                            </li>
                            <li><strong>Verifica la URL</strong>
                                <ul>
                                    <li>Abre en el navegador: <a href="http://localhost/eco-app/greentech/api" target="_blank">http://localhost/eco-app/greentech/api</a></li>
                                    <li>Deber√≠a mostrar informaci√≥n de la API</li>
                                </ul>
                            </li>
                            <li><strong>Verifica que el proyecto est√© en:</strong>
                                <ul>
                                    <li>C:\\xampp\\htdocs\\eco-app\\greentech</li>
                                </ul>
                            </li>
                        </ol>
                    `;
          } else if (error.message.includes("404")) {
            errorMessage = "API no encontrada (Error 404)";
            suggestion = `
                        <h4>Soluciones:</h4>
                        <ul>
                            <li>Verifica que la carpeta del proyecto est√© en: <code>C:\\xampp\\htdocs\\eco-app\\greentech</code></li>
                            <li>Verifica que existe el archivo: <code>api/index.php</code></li>
                            <li>Verifica que existe el archivo: <code>.htaccess</code></li>
                        </ul>
                    `;
          } else if (error.message.includes("500")) {
            errorMessage = "Error interno del servidor (Error 500)";
            suggestion = `
                        <h4>Soluciones:</h4>
                        <ul>
                            <li>Revisa el log de errores de Apache en XAMPP</li>
                            <li>Verifica la configuraci√≥n de PHP en <code>api/config/database.php</code></li>
                            <li>Aseg√∫rate de que MySQL est√© corriendo</li>
                        </ul>
                    `;
          }

          resultDiv.innerHTML = `
                    <div class="status error">
                        <h3>‚ùå Error de Conexi√≥n</h3>
                        <p><strong>Error:</strong> ${errorMessage}</p>
                        <p><strong>Detalle:</strong> ${error.message}</p>
                        ${suggestion}
                        <h4>Detalles T√©cnicos:</h4>
                        <pre>${error.stack || error.toString()}</pre>
                    </div>
                `;
        }
      }

      // Auto-test al cargar la p√°gina
      window.addEventListener("load", () => {
        setTimeout(() => {
          console.log("üöÄ Ejecutando test autom√°tico...");
          testConnection();
        }, 500);
      });
    </script>
  </body>
</html>
