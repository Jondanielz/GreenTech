# Apache Configuration para Purple Admin
# Permite el ruteo de la API y archivos estáticos

<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /eco-app/GreenTech/

  # ========== CORS Headers ==========
  # NOTA: Los headers CORS se manejan en api/config/cors.php
  # No configurar aquí para evitar conflictos

  # ========== API Routes ==========
  # Redirigir todas las peticiones a /api/* al router de la API
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^api/(.*)$ api/index.php [QSA,L]

  # ========== Static Files ==========
  # No reescribir archivos y directorios que existan
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]

  # ========== SPA Routing (para Vite) ==========
  # Redirigir todas las demás peticiones a index.html para SPA
  # RewriteRule ^ index.html [L]
</IfModule>

# ========== PHP Configuration ==========
<IfModule mod_php.c>
  # Aumentar límites de PHP
  php_value upload_max_filesize 64M
  php_value post_max_size 64M
  php_value max_execution_time 300
  php_value max_input_time 300
  
  # Configuración de sesiones
  php_value session.cookie_httponly 1
  php_value session.cookie_secure 0
  php_value session.use_strict_mode 1
</IfModule>

# ========== Security Headers ==========
<IfModule mod_headers.c>
  # Prevenir clickjacking
  Header always set X-Frame-Options "SAMEORIGIN"
  
  # Prevenir MIME type sniffing
  Header always set X-Content-Type-Options "nosniff"
  
  # XSS Protection
  Header always set X-XSS-Protection "1; mode=block"
  
  # Referrer Policy
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# ========== Compression ==========
<IfModule mod_deflate.c>
  # Comprimir HTML, CSS, JavaScript, JSON
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json application/xml
</IfModule>

# ========== Cache Control ==========
<IfModule mod_expires.c>
  ExpiresActive On
  
  # Imágenes
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 year"
  
  # CSS y JavaScript
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType text/javascript "access plus 1 month"
  
  # Fuentes
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType application/font-woff "access plus 1 year"
  ExpiresByType application/font-woff2 "access plus 1 year"
  
  # HTML
  ExpiresByType text/html "access plus 0 seconds"
</IfModule>

# ========== Protección de Archivos ==========
# Denegar acceso a archivos sensibles
<FilesMatch "\.(env|log|sql|md|gitignore)$">
  Require all denied
</FilesMatch>

# Proteger archivos de configuración (git, svn, htaccess)
<FilesMatch "^\.">
  Require all denied
</FilesMatch>

